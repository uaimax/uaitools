---
description: "Regras globais para todo o reposit√≥rio SaaS Bootstrap"
globs:
  - "**/*"
alwaysApply: true
---

# Regras Globais ‚Äî SaaS Bootstrap

@CLAUDE.md
@AGENTS.md

## Contexto do Projeto

- **Stack**: Django 5 + DRF
- **Arquitetura**: Multi-tenancy por `tenant_id`
- **Fase atual**: Funda√ß√£o (Fase 1)

## Regras Universais

### ALWAYS

1. **Type hints** em todas as fun√ß√µes Python
2. **Docstrings** em classes e fun√ß√µes p√∫blicas
3. **Arquivos < 300 linhas**
4. **Testes junto ao app** em `tests/`
5. **APIs com prefixo `/api/`**
6. **Vari√°veis de ambiente** para configura√ß√µes sens√≠veis

### NEVER

1. **NUNCA modificar migrations existentes**
2. **NUNCA alterar models cr√≠ticos** (User, Tenant, TenantModel) sem autoriza√ß√£o
3. **NUNCA modificar middleware** de tenant
4. **NUNCA hardcodar** URLs, secrets ou configura√ß√µes de deploy
5. **NUNCA ignorar** zonas de prote√ß√£o

## Zonas de Prote√ß√£o

üî¥ **ZONA VERMELHA** ‚Äî NUNCA TOCAR:
- `backend/apps/accounts/migrations/`
- `backend/apps/accounts/models.py`
- `backend/apps/core/models.py`
- `backend/apps/core/middleware.py`
- `backend/core/settings/prod.py`

üü° **ZONA AMARELA** ‚Äî CUIDADO:
- `backend/core/settings/base.py`
- `backend/core/urls.py`
- Scripts shell (`*.sh`)

## Comandos √öteis

```bash
./dev-start.sh    # Inicia desenvolvimento
./run-tests.sh    # Executa testes
make migrate      # Aplica migrations
```

## Consulta de Erros no GlitchTip/Sentry

### Quando Consultar Erros

Sempre que precisar investigar erros ou problemas reportados, consulte diretamente o GlitchTip/Sentry:

1. **Obter URL do GlitchTip**:
   - As credenciais est√£o nas vari√°veis de ambiente (`.env` do backend e frontend)
   - Backend: `SENTRY_DSN` (formato: `https://xxx@app.glitchtip.com/14243`)
   - Frontend: `VITE_SENTRY_DSN` (mesmo formato)
   - Extrair a URL base do DSN: `https://app.glitchtip.com` (ou URL do self-hosted)

2. **Acessar o Dashboard**:
   - URL padr√£o SaaS: `https://app.glitchtip.com`
   - URL self-hosted: Extrair do DSN (ex: `http://localhost:8000` ou URL customizada)
   - Credenciais de acesso est√£o nas vari√°veis de ambiente ou documenta√ß√£o do projeto

3. **Consultar Erros Espec√≠ficos**:
   - Filtrar por projeto (identificado pelo ID no DSN)
   - Filtrar por ambiente (`ENVIRONMENT` do backend)
   - Filtrar por data, n√≠vel (ERROR, WARNING), ou mensagem
   - Ver stack traces completos, contexto do request, e breadcrumbs

4. **Verificar Configura√ß√£o**:
   ```bash
   # Backend - Verificar se est√° configurado
   cd backend
   cat .env | grep SENTRY_DSN

   # Frontend - Verificar se est√° configurado
   cd frontend
   cat .env | grep VITE_SENTRY_DSN
   ```

5. **Testar Conex√£o**:
   ```bash
   # Backend
   python manage.py test_glitchtip

   # Ou via script standalone
   python backend/test_glitchtip_connection.py
   ```

**Importante**:
- As credenciais (DSN) est√£o nas `.env` do backend e frontend
- O DSN cont√©m a URL do GlitchTip e o ID do projeto
- Use o dashboard para an√°lise detalhada de erros antes de debugar c√≥digo

## Refer√™ncias

- @docs/context/PROTECTED_AREAS.md
- @docs/ARCHITECTURE.md
- @docs/GLITCHTIP_SETUP.md - Setup e configura√ß√£o do GlitchTip
