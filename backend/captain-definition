{
  "schemaVersion": 2,
  "dockerfileLines": [
    "FROM python:3.12-slim",
    "",
    "# Vari√°veis de ambiente",
    "ENV PYTHONUNBUFFERED=1",
    "ENV PYTHONDONTWRITEBYTECODE=1",
    "ENV ENVIRONMENT=production",
    "",
    "# Instalar depend√™ncias do sistema",
    "RUN apt-get update && apt-get install -y \\",
    "    gcc \\",
    "    postgresql-client \\",
    "    && rm -rf /var/lib/apt/lists/*",
    "",
    "# Criar diret√≥rio de trabalho",
    "WORKDIR /app",
    "",
    "# Copiar requirements e instalar depend√™ncias Python",
    "COPY requirements.txt /app/",
    "RUN pip install --no-cache-dir --upgrade pip && \\",
    "    pip install --no-cache-dir -r requirements.txt && \\",
    "    pip install --no-cache-dir gunicorn",
    "",
    "# Copiar c√≥digo da aplica√ß√£o",
    "COPY . /app/",
    "",
    "# Coletar arquivos est√°ticos (usar development durante build)",
    "RUN ENVIRONMENT=development python manage.py collectstatic --noinput || true",
    "",
    "# Expor porta",
    "EXPOSE 80",
    "",
    "# Script de inicializa√ß√£o que aplica migrations antes de iniciar",
    "RUN echo '#!/bin/bash\\nset -e\\necho \"üì¶ Aplicando migrations...\"\\npython manage.py migrate --noinput\\necho \"‚úÖ Migrations aplicadas\"\\necho \"üöÄ Iniciando Gunicorn...\"\\nexec gunicorn --bind 0.0.0.0:80 --workers 3 --timeout 120 --access-logfile - --error-logfile - config.wsgi:application' > /app/start.sh && chmod +x /app/start.sh",
    "",
    "# Comando para iniciar aplica√ß√£o (executa migrations antes)",
    "CMD [\"/app/start.sh\"]"
  ]
}

